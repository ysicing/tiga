# 快速启动指南：MinIO 对象存储管理系统

**功能**：004-minio-minio-bucket | **日期**：2025-10-14

## 前置条件

1. 安装并运行 MinIO 服务器（用于测试）
2. Tiga 后端服务运行中（`task dev`）
3. 前端开发服务运行中（`cd ui && pnpm dev`）
4. 管理员账户已登录

## 场景 1：管理员添加 MinIO 实例

### 步骤

1. **导航到 MinIO 管理页面**
   - 打开浏览器：http://localhost:5173
   - 登录管理员账户
   - 点击侧边栏 "对象存储" → "实例管理"

2. **添加新实例**
   - 点击 "添加实例" 按钮
   - 填写表单：
     * 名称：测试 MinIO
     * 端点：localhost:9000
     * AccessKey：minioadmin
     * SecretKey：minioadmin
     * 使用 SSL：否（本地测试）
   - 点击 "测试连接"
   - 连接成功后点击 "保存"

3. **验证**
   - 实例列表显示新实例
   - 状态为 "在线"
   - 显示版本号和存储统计

**预期结果**：
- ✅ 实例创建成功
- ✅ 连接状态为在线
- ✅ 审计日志记录实例创建操作

## 场景 2：管理员创建 Bucket 和用户

### 步骤

1. **创建 Bucket**
   - 点击实例进入详情页
   - 切换到 "Buckets" 标签
   - 点击 "创建 Bucket"
   - 输入名称：team-assets
   - 选择策略：私有
   - 点击 "创建"

2. **创建用户**
   - 切换到 "用户" 标签
   - 点击 "创建用户"
   - 输入用户名：dev-user
   - 点击 "生成密钥"
   - **记录 SecretKey**（仅显示一次）
   - 点击 "创建"

3. **授予权限**
   - 切换到 "权限" 标签
   - 点击 "授予权限"
   - 选择用户：dev-user
   - 选择 Bucket：team-assets
   - 选择权限：读写
   - 点击 "授予"

**预期结果**：
- ✅ Bucket 创建成功
- ✅ 用户创建成功，SecretKey 显示一次
- ✅ 权限授予成功
- ✅ 审计日志记录所有操作

## 场景 3：用户上传和预览文件

### 步骤

1. **上传图片**
   - 进入文件浏览页面
   - 选择 Bucket：team-assets
   - 点击 "上传文件"
   - 选择图片文件（test.jpg）
   - 观察上传进度（百分比、速度、剩余时间）
   - 等待上传完成

2. **预览图片**
   - 文件列表中找到 test.jpg
   - 点击文件名或预览图标
   - 图片在弹窗中显示
   - 测试缩放、旋转功能

3. **上传代码文件**
   - 上传 script.py
   - 点击文件名
   - 代码以语法高亮显示
   - 验证 Python 语法高亮正确

**预期结果**：
- ✅ 上传进度正确显示
- ✅ 图片预览正常
- ✅ 代码高亮正确
- ✅ 审计日志记录文件上传

## 场景 4：用户生成分享链接

### 步骤

1. **生成分享链接**
   - 选择 test.jpg
   - 点击 "分享" 按钮
   - 选择过期时间：7 天
   - 点击 "生成链接"
   - 复制链接到剪贴板

2. **测试分享链接**
   - 打开新的隐身窗口（未登录状态）
   - 粘贴分享链接
   - 验证图片可以查看/下载
   - 关闭隐身窗口

3. **查看分享记录**
   - 返回已登录窗口
   - 进入 "分享链接" 页面
   - 验证链接显示在列表中
   - 显示过期时间、状态

**预期结果**：
- ✅ 分享链接生成成功
- ✅ 未登录用户可访问
- ✅ 分享记录可查询
- ✅ 审计日志记录分享操作

## 场景 5：管理员查看审计日志

### 步骤

1. **查看审计日志**
   - 进入 "审计日志" 页面
   - 查看所有操作记录
   - 验证包含：
     * 实例创建
     * Bucket 创建
     * 用户创建
     * 权限授予
     * 文件上传
     * 分享链接创建

2. **筛选日志**
   - 按时间筛选：今天
   - 按操作类型筛选：file_upload
   - 按用户筛选：dev-user
   - 验证结果正确

**预期结果**：
- ✅ 所有操作都有审计日志
- ✅ 日志包含操作者、时间、结果、IP
- ✅ 筛选功能正常

## 清理（可选）

```bash
# 删除测试 Bucket
mc rb local/team-assets --force

# 删除测试用户
mc admin user remove local dev-user

# 删除实例（在 UI 中）
```

## 故障排查

**实例连接失败**：
- 检查 MinIO 服务器是否运行
- 验证端点地址正确
- 检查 AccessKey/SecretKey

**文件上传失败**：
- 检查用户权限
- 检查 Bucket 策略
- 查看浏览器控制台错误

**预览不工作**：
- 检查文件格式是否支持
- 检查 presigned URL 是否过期
- 查看网络请求状态

---
*快速启动指南完成*
*下一步：运行 `/spec-kit:tasks` 生成详细任务列表*
